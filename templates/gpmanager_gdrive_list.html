{% extends "base.html" %}
{% block content %}


<div>
  <form id="form_search" name="from_search" class="form-inline" style="text-align:left">
    <div class="container-fluid">
      <div class="row show-grid" align="center">
        <span class="col-md-12" align="left">
          <span class="col-md-4" style="align-items:left; text-align:left;">
            <select name='category'>
              <option value="all">전체</option>
            </select>
         </span>
         <span class="col-md-6">
	  <input id="search_word" name="search_word" class="form-control form-control-sm w-50" type="text" placeholder="제목입력" aria-label="Search">
	 </span>
         <span class="col-md-2">
          {{ macros.m_button_group([['search', '검색'], ['reset_btn', '리셋']]) }}
         </span>
        </span>
       </div>
      <hr>
    </div>
  </form>
  <div id='page1'></div>
<div>
<hr>
  <div id="list_div"></div>
  <div id='page2'></div>
</div>

<script type="text/javascript">
var package_name = "{{arg['package_name'] }}";
var str_categories = "{{arg['categories'] }}";
var sub = "{{arg['sub'] }}";
var current_data = null;
var current_page = 1;
var formData = null;
var country = 'all';
var categories = str_categories.split(',');

$(document).ready(function(){
  formData = get_formdata('#form_search');
  set_category_options();
  global_sub_request_search('1', true);
});

$("body").on('click', '#page', function(e){
  e.preventDefault();
  var page = $(this).data('page')
  global_sub_request_search(page, true);
});

$("#search").click(function(e) {
  e.preventDefault();
  global_sub_request_search('1', true);
});

$("#reset_btn").click(function(e) {
  e.preventDefault();
  document.getElementById("search_word").value = '';
  global_sub_request_search(current_page, true);
});

function make_list(data) {
  str = '';
  tmp = '';
  str += m_row_start();
  for (i in data) {
    str += '<div class="col-md-2 col-sm-4 col-6">';
    str += '<div class="card mb-2 box-shadow">';
    str += '<img class="card-img-top" src="'+data[i].poster_url+'" class="img-fluid img-thumbnail">';
    str += '<div class="card-body" style="padding:2px 1px 2px 1px;">';
    str += '<p class="card-text">';
    str += '<strong>' + data[i].title + '</strong> / ' + data[i].agent_type + '<br>';
    str += '<small class="text-muted">';
    str += 'Y: '+data[i].year+ ' /Site: '+data[i].site+'<br>';
    str += '</small>';
    str += '</p>';
    str += '<div class="d-flex justify-content-between align-items-center" style="padding:2px 1px 2px 1px;"><br>';
    tmp = m_button2('global_json_btn', '정보', [{'key':'id', 'value':data[i].id}], 'info');
    if (data[i].shortcut_created == null) {
      tmp += m_button2('shortcut_create_btn', '추가', [{'key':'id', 'value':data[i].id}], 'info');
    }
    tmp += m_button2('shortcut_remove_btn', '삭제', [{'key':'id', 'value':data[i].id}], 'danger');
    btn_str = m_button_group(tmp);
    str += btn_str;
    str += '<small class="text-muted"></small>';
    str += '</div>';
    str += '</div>';
    str += '</div>';
    str += '</div>';
  }
  str += m_row_end();
  document.getElementById("list_div").innerHTML = str;
}

$("body").on('click', '#strm_all_plex_btn', function(e){
  e.preventDefault();
  type = 'plex';
  create_strm_batch(type);
});

$("body").on('click', '#strm_all_kodi_btn', function(e){
  e.preventDefault();
  type = 'kodi';
  create_strm_batch(type);
});

$("body").on('click', '#strm_all_btn', function(e){
  e.preventDefault();
  type = 'all';
  create_strm_batch(type);
});

$("body").on('click', '#shortcut_remove_btn', function(e){
  e.preventDefault();
  code = $(this).data('code');
  type = 'kodi';
  create_strm(code, type);
});

$("body").on('click', '#shortcut_create_btn', function(e){
  e.preventDefault();
  id = $(this).data('id');
  create_shortcut(id);
});

function create_shortcut(id) {
  $.ajax({
    url: '/' + package_name + '/ajax/'+sub+'/create_shortcut',
    type: "POST",
    cache: false,
    data: {'id':id},
    dataType: "json",
    success: function (data) {
      if ( data.ret == 'success') {
        $.notify('<strong>성공: '+data.msg+'</strong>', {type: 'success'});
      } else {
        $.notify('<strong>실패: ' +data.msg+ '</strong>', {type: 'warning'});
      }
      request_search(current_page);
    }
  });
}

function set_category_options() {
  form_search.category.options[0] = new Option('전체', 'all');
  for (i = 0; i < categories.length; i++) {
    form_search.category.options[i+1] = new Option(categories[i],categories[i]);
  }
}

</script>    
{% endblock %}
